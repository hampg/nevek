<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <title>A tökéletes keresztnév</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 980px; margin: 40px auto; padding: 0 16px; }
    h1 { margin: 0 0 8px; }
    .muted { color: #555; line-height: 1.4; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 16px; margin-top: 16px; }
    label.top { display:block; margin-top: 12px; font-weight: 800; }
    input[type="text"], select, button {
      width: 100%;
      font-size: 16px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      margin-top: 6px;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    button { background:#111; color:#fff; cursor:pointer; margin-top: 14px; border-color:#111; }
    button:disabled { opacity: 0.6; cursor:not-allowed; }
    .rules { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 10px; }
    .rule {
      display: flex; gap: 10px; align-items: flex-start;
      padding: 10px; border: 1px solid #eee; border-radius: 12px;
      background: #fafafa;
    }
    .rule input { margin-top: 3px; }
    .rule b { display:block; }
    .status { margin-top: 14px; font-weight: 800; }
    .ok { color: #0a6b0a; }
    .error { color: #b00020; }
    .results {
      margin-top: 12px;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 12px;
      max-height: 380px;
      overflow-y: auto;
      line-height: 1.45;
      font-size: 15px;
      background: #fff;
    }
    .pill {
      display:inline-block; padding: 2px 8px; border:1px solid #ddd; border-radius: 999px;
      font-size: 12px; color:#333; background:#f6f6f6;
    }
    code { background:#f3f3f3; padding: 2px 6px; border-radius: 8px; }
    details { margin-top: 10px; }
    .small { font-size: 13px; }
  </style>
</head>
<body>

  <h1>Magyar keresztnév-kereső</h1>
  <div class="muted">
<--    Nevek: <code>lany_nevek.txt</code> és <code>fiu_nevek.txt</code> (soronként 1 név).
    A szabályokat alul kapcsolgathatod. -->
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label class="top" for="surname">Vezetéknév</label>
        <input id="surname" type="text" placeholder="pl. Bárány" autocomplete="family-name">
      </div>
      <div>
        <label class="top" for="gender">Lány vagy fiú?</label>
        <select id="gender">
          <option value="female">Lány</option>
          <option value="male">Fiú</option>
        </select>
      </div>
    </div>

    <label class="top" style="margin-top:16px;">Szabályok (tikkelős)</label>
    <div class="rules">
      <div class="rule">
        <input id="rule_boundary_vc" type="checkbox" checked>
        <div>
          <b>Váltakozás a névhatáron (végződés ↔ kezdés)</b>
          <div class="muted small">Ha a vezetéknév magánhangzóra végződik, a keresztnév mássalhangzóval kezdődjön; és fordítva.</div>
        </div>
      </div>

      <div class="rule">
        <input id="rule_given_no_repeat" type="checkbox" checked>
        <div>
          <b>Keresztnévben nincs betűismétlődés</b>
          <div class="muted small">Pl. <code>Kati</code> oké, <code>Kata</code nem (két <code>a</code>).</div>
        </div>
      </div>

      <div class="rule">
        <input id="rule_cross_no_overlap" type="checkbox" checked>
        <div>
          <b>Vezetéknév és keresztnév között nincs közös betű</b>
          <div class="muted small">A vezetéknév belső ismétlése nem gond; csak az a baj, ha ugyanaz a token megjelenik a keresztnévben is.</div>
        </div>
      </div>

      <div class="rule">
        <input id="rule_alliteration" type="checkbox">
        <div>
          <b>Alliteráció</b> <span class="pill">új</span>
          <div class="muted small">A vezetéknév első hangja egyezzen a keresztnév első hangjával (pl. <code>Kovács K...</code>).</div>
        </div>
      </div>
    </div>

    <button id="runBtn">Összes megfelelő név listázása</button>

    <div id="status" class="status"></div>
    <div id="results" class="results" style="display:none;"></div>

    <details>
      <summary>Mi számít „betűnek”?</summary>
      <div class="muted small">
        Egy betűnek vesszük: <code>dzs</code>, <code>dz</code>, <code>cs</code>, <code>gy</code>, <code>ly</code>, <code>ny</code>, <code>sz</code>, <code>ty</code>, <code>zs</code>.
        A többi karakter 1 token. (Ékezetes magánhangzók külön betűk: <code>a</code> ≠ <code>á</code>.)
      </div>
    </details>
  </div>

<script>
(() => {
  // Magyar többjegyű betűk (hosszabb elöl!)
  const MULTI = ["dzs","dz","cs","gy","ly","ny","sz","ty","zs"];
  const VOWELS = new Set(["a","á","e","é","i","í","o","ó","ö","ő","u","ú","ü","ű"]);

  const $surname = document.getElementById("surname");
  const $gender  = document.getElementById("gender");
  const $runBtn  = document.getElementById("runBtn");
  const $status  = document.getElementById("status");
  const $results = document.getElementById("results");

  const $ruleBoundaryVC   = document.getElementById("rule_boundary_vc");
  const $ruleGivenNoRep   = document.getElementById("rule_given_no_repeat");
  const $ruleCrossNoOver  = document.getElementById("rule_cross_no_overlap");
  const $ruleAlliteration = document.getElementById("rule_alliteration");

  function normalize(s) {
    return (s || "")
      .toLowerCase()
      .trim()
      .replace(/[\s.\-’'"]/g, "");
  }

  function tokenizeHu(word) {
    const s = normalize(word);
    const tokens = [];
    let i = 0;
    while (i < s.length) {
      let found = null;
      for (const m of MULTI) {
        if (s.startsWith(m, i)) { found = m; break; }
      }
      if (found) { tokens.push(found); i += found.length; }
      else { tokens.push(s[i]); i++; }
    }
    return tokens.filter(Boolean);
  }

  function isVowelToken(tok) { return VOWELS.has(tok); }

  function hasNoRepeats(tokens) { return new Set(tokens).size === tokens.length; }

  async function loadTxt(path) {
    const r = await fetch(path, { cache: "no-store" });
    if (!r.ok) throw new Error("Nem tölthető: " + path + " (HTTP " + r.status + ")");
    const text = await r.text();
    return text.split(/\r?\n/).map(x => x.trim()).filter(Boolean);
  }

  function currentRules() {
    return {
      boundaryVC: $ruleBoundaryVC.checked,
      givenNoRepeat: $ruleGivenNoRep.checked,
      crossNoOverlap: $ruleCrossNoOver.checked,
      alliteration: $ruleAlliteration.checked
    };
  }

  function canCombine(surname, given, rules) {
    const sTok = tokenizeHu(surname);
    const gTok = tokenizeHu(given);
    if (sTok.length === 0 || gTok.length === 0) return false;

    // Alliteráció: első token egyezzen
    if (rules.alliteration) {
      if (sTok[0] !== gTok[0]) return false;
    }

    // Váltakozás a névhatáron: vége ↔ eleje (mgh/msh)
    if (rules.boundaryVC) {
      const endVowel   = isVowelToken(sTok[sTok.length - 1]);
      const startVowel = isVowelToken(gTok[0]);
      if (endVowel === startVowel) return false;
    }

    // Keresztnévben nincs ismétlődés
    if (rules.givenNoRepeat) {
      if (!hasNoRepeats(gTok)) return false;
    }

    // Nincs közös token a vezetéknév és keresztnév között
    // (a vezetéknév belső ismétlése itt nem számít)
    if (rules.crossNoOverlap) {
      const sSet = new Set(sTok);
      for (const t of gTok) {
        if (sSet.has(t)) return false;
      }
    }

    return true;
  }

  function describeRules(r) {
    const on = [];
    if (r.boundaryVC) on.push("váltakozás a névhatáron");
    if (r.givenNoRepeat) on.push("keresztnévben nincs ismétlés");
    if (r.crossNoOverlap) on.push("nincs közös token a két név között");
    if (r.alliteration) on.push("alliteráció (azonos kezdő token)");
    return on.length ? on.join(", ") : "nincsenek bekapcsolt szabályok";
  }

  $runBtn.addEventListener("click", async () => {
    const surname = $surname.value.trim();
    if (!surname) {
      $status.innerHTML = "<span class='error'>Adj meg vezetéknevet.</span>";
      $results.style.display = "none";
      return;
    }

    const rules = currentRules();

    $runBtn.disabled = true;
    $results.style.display = "none";
    $results.innerHTML = "";
    $status.textContent = "Névlista betöltése…";

    try {
      const file = ($gender.value === "female") ? "lany_nevek.txt" : "fiu_nevek.txt";
      const names = await loadTxt(file);

      const matches = [];
      for (const n of names) {
        if (canCombine(surname, n, rules)) matches.push(n);
      }

      if (matches.length === 0) {
        $status.innerHTML =
          "<span class='error'>A jelenlegi szabályok szerint nem lehet találni ilyen nevet.</span><br>" +
          `<span class="muted small">Bekapcsolt szabályok: ${describeRules(rules)}.</span>`;
        $runBtn.disabled = false;
        return;
      }

      $status.innerHTML =
        `<span class='ok'>Kész: ${matches.length} találat.</span><br>` +
        `<span class="muted small">Bekapcsolt szabályok: ${describeRules(rules)}.</span>`;

      // Egyben listázzuk: "Vezetéknév Keresztnév"
      $results.innerHTML = matches.map(n => `${surname} ${n}`).join("<br>");
      $results.style.display = "block";

    } catch (e) {
      $status.innerHTML = `<span class='error'>Hiba:</span> ${e.message}`;
    }

    $runBtn.disabled = false;
  });

  // Enter a vezetéknévnél indít
  $surname.addEventListener("keydown", (e) => {
    if (e.key === "Enter") $runBtn.click();
  });

})();
</script>

</body>
</html>
